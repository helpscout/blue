import { Meta, Story, ArgsTable, Canvas } from '@storybook/addon-docs/blocks'
import { boolean, number, text, select } from '@storybook/addon-knobs'
import DropList from './DropList'
import {
  Button,
  SelectTag,
  SplitButton,
  Kebab,
  IconButton,
} from './DropList.togglers'
import {
  itemsWithDivider,
  simpleGroupedItems,
  plainItems,
  regularItems,
} from '../../utilities/specs/dropdown.specs'

<Meta
  title="Components/Dropdowns/DropList"
  component={DropList}
  parameters={{
    design: {
      type: 'figma',
      url: '',
    },
  }}
/>

# DropList

A component to build simple WAI-ARIA compliant combobox or select dropdowns that conform to Help Scout's design guidelines and sensible defaults.

Under the hood DropList is powered by two third party open source libraries: [Downshift](https://www.downshift-js.com/) and [Tippy](https://atomiks.github.io/tippyjs/v6/all-props/).

#### Downshift

This library has 2 flavours, _hooks_ and _components_. DropList utilices the provided hooks `useSelect` and `useCombobox`, which handle most of the logic a dropdown requires like events, a11y and state.

Downshift fundamentally treats "select" and "combobox" components as 2 different paradigms with their own separate considerations (especially when it comes in how each handle a11y stuff and events). In a nutshell a _select_ is not just a _combobox_ with the search input hidden. DropList abstracts this for you providing a unified component while under the hood following the Downshift paradigm.

#### Tippy

We use this library to power our `Tooltip` component and it's being used here to handle the positioning of the DropList, as well as its open/closed state.

<Canvas>
  <Story name="default">
    <div
      style={{
        width: '400px',
        margin: '50px 100px 200px 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList
        variant="combobox"
        items={regularItems}
        onOpenedStateChange={isOpen => {
          console.log('isOpen', isOpen)
        }}
        onSelect={selection => {
          console.log('selection', selection)
        }}
        toggler={
          <SplitButton
            text="Click"
            onActionClick={() => {
              console.log('Action!')
            }}
            onClick={() => {
              console.log('Clicked from story')
            }}
          />
        }
      />
    </div>
  </Story>
</Canvas>

#### Reference

- **Designer**: Buzz
- **Engineering**: Juan Pablo
- **Usage**: Everywhere

<br />
<br />

### Props

<ArgsTable of={DropList} />

## Stories

### List items

DropList accepts an array of items, these items can be:

- Strings: `['a', 'b', 'c']`
- Objects (only the label is required):

```js
const ItemObjectShape = PropTypes.shape({
  label: PropTypes.string.isRequired,
  id: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),
})
```

- Dividers: Add a `type = divider` property to an object to create a divider

```js
const items = [
  { label: 'a' },
  { label: 'ab' },
  { label: 'abc' },
  { type: 'divider' },
  { label: 'b' },
]
```

<Canvas>
  <Story name="Items: divider">
    <div
      style={{
        width: '400px',
        margin: '50px 100px 200px 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList items={itemsWithDivider} toggler={<Button text="Click" />} />
    </div>
  </Story>
</Canvas>

- Groups: Add a `type = group` property (don't forget to add `label` to the group) and nest items to an object to create a group:

```js
const groupedItems = [
  {
    items: [{}, {}, {}],
    label: 'Group 1',
    type: 'group',
  },
  {
    items: [{}, {}, {}],
    label: 'Group 2',
    type: 'group',
  },
]
```

<Canvas>
  <Story name="Items: groups">
    <div
      style={{
        width: '400px',
        margin: '50px 100px 200px 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList items={simpleGroupedItems} toggler={<Button text="Click" />} />
    </div>
  </Story>
</Canvas>

### Multiple selection

Depending on your use case, you might want to set `closeOnSelection = false` when multiple selection is enabled.

<Canvas>
  <Story name="Multiple Selection">
    <div
      style={{
        width: '400px',
        margin: '50px 100px 200px 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList
        items={regularItems}
        closeOnSelection={false}
        onSelect={selection => {
          console.log('selection', selection)
        }}
        toggler={<Button text="Submit" />}
        withMultipleSelection
      />
    </div>
  </Story>
</Canvas>

### Togglers

DropList provides a set of ready-to-use "triggers" or "togglers" components that should cover most if not all of our current needs: `Button`, `IconButton`, `Kebab`, `SelectTag` and `SplitButton`. Import them into your project from `src/components/DropList/DropList.togglers.jsx` and feed them to the `toggler` prop.

#### Custom Toggler

The `toggler` prop accepts any React component, so you can provide your own custom trigger. Just one thing is necessary for everything to work as expected and a couple of other considerations:

- (Required) Refs: Wrap your toggler component in `React.forwardRef`, this in turn is fed to Tippy so that it can do its thing. The `ref` should be applied to the button that when clicked is the one that opens/closes the DropList. For a component that illustrates this check the SplitButton toggler (since this "toggler" is composed of 2 buttons).
- `onClick`: DropList will merge your `onClick` prop with an internal one that opens/closes the DropList (this way you can attach extra actions to the click event). Again, check SplitButton as an example for when you have 2 buttons each with its own click handler, the one with the prop named `onClick` is the one that will actually open/close the list.
- If your "toggler" contains a button or any other clickable element and you would like to avoid closing the DropList on clicking it, add the data attribute `data-ignore-toggling="true"` to that element.
- Aria label: Don't forget to add `aria-label` to the toggler button, with something like "toggle menu".

<Canvas>
  <Story name="Toggler: Button">
    <div
      style={{
        width: '400px',
        margin: '50px 100px 0 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList
        items={regularItems}
        toggler={
          <Button
            text="Click"
            onClick={() => {
              console.log('Clicked from story')
            }}
          />
        }
      />
    </div>
  </Story>
  <Story name="Toggler: IconButton">
    <div
      style={{
        width: '400px',
        margin: '50px 100px 0 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList
        items={regularItems}
        toggler={
          <IconButton
            onClick={() => {
              console.log('Clicked from story')
            }}
          />
        }
      />
    </div>
  </Story>
  <Story name="Toggler: Kebab">
    <div
      style={{
        width: '400px',
        margin: '50px 100px 0 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList
        items={regularItems}
        toggler={
          <Kebab
            onClick={() => {
              console.log('Clicked from story')
            }}
          />
        }
      />
    </div>
  </Story>
  <Story name="Toggler: SelectTag">
    <div
      style={{
        width: '400px',
        margin: '50px 100px 0 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList
        items={regularItems}
        toggler={
          <SelectTag
            onClick={() => {
              console.log('Clicked from story')
            }}
          />
        }
      />
    </div>
  </Story>
  <Story name="Toggler: SplitButton">
    <pre>{JSON.stringify(regularItems, null, ' ')}</pre>
    <div
      style={{
        width: '400px',
        margin: '50px 100px 0 150px',
        border: '1px dashed silver',
        borderRadius: '5px',
        padding: '20px',
      }}
    >
      <DropList
        items={regularItems}
        toggler={
          <SplitButton
            text="Click"
            onActionClick={() => {
              console.log('Action!')
            }}
            onClick={() => {
              console.log('Clicked from story')
            }}
          />
        }
      />
    </div>
  </Story>
</Canvas>
